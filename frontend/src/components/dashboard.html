<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¦¬ë·° ë¶„ì„ ëŒ€ì‹œë³´ë“œ</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts (Inter + Noto Sans KR) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&family=Noto+Sans+KR:wght@100..900&display=swap" rel="stylesheet">
    <!-- Chart.js CDN -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.2/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.0.0"></script>
    <!-- html2pdf.js CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js" xintegrity="sha512-Z59GU/RABaeYpUN5yV/7G/Xk+g14h0oT/6jHwQvYQJ/S6C/x5/g2g/oFq7J5E8Yn8p0lB4i1wz7l6/4A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <style>
        /* Custom Styles based on Design System */
        :root {
            --bg-color: #F9FAFB;
            --card-bg: #FFFFFF;
            --border-color: #E5E7EB;
            --main-color: #5B8EFF;
            --font-color: #333333;
            --positive-highlight: #10B981; /* Green for ğŸŸ© */
            --negative-highlight: #EF4444; /* Red for ğŸŸ¥ */
            --neutral-color: #CBD5E1; /* Grey for ğŸ˜Ÿ/Neutral */
            --card-radius: 12px;
            --card-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        body {
            font-family: 'Inter', 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            color: var(--font-color);
            min-height: 100vh;
        }
        .card {
            background-color: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: var(--card-radius);
            box-shadow: var(--card-shadow);
            padding: 24px;
        }
        .text-main { color: var(--main-color); }
        .bg-main { background-color: var(--main-color); }
        .text-neutral { color: var(--neutral-color); }
        .bg-neutral { background-color: var(--neutral-color); }
        .text-pos { color: var(--positive-highlight); }
        .bg-pos-light { background-color: #D1FAE5; } /* Light Green for tag background */
        .text-neg { color: var(--negative-highlight); }
        .bg-neg-light { background-color: #FEE2E2; } /* Light Red for tag background */
        .kpi-change-up { color: var(--positive-highlight); }
        .kpi-change-down { color: var(--negative-highlight); }

        /* Ensure responsive font sizes for readability */
        h1 { font-size: 1.875rem; font-weight: 700; } /* 3xl */
        h2 { font-size: 1.5rem; font-weight: 600; } /* 2xl */
        h3 { font-size: 1.125rem; font-weight: 600; } /* lg */

        /* Utility for PDF generation */
        #dashboard-content {
            padding: 24px;
            background-color: var(--bg-color);
        }
    </style>
</head>
<body>

<div id="dashboard-content" class="max-w-7xl mx-auto space-y-6">

    <!-- Header & Filter Section -->
    <header class="pt-6 pb-4">
        <h1 class="text-3xl font-extrabold text-gray-800">ë¦¬ë·° ë¶„ì„ ëŒ€ì‹œë³´ë“œ</h1>
        <div class="mt-4 p-4 border-b border-gray-200 flex flex-col md:flex-row md:items-center justify-between bg-white rounded-xl shadow-sm">
            <div class="mb-3 md:mb-0">
                <span class="text-xs font-semibold uppercase text-gray-500 mr-2">ë¶„ì„ ëŒ€ìƒ</span>
                <span class="text-2xl font-bold text-gray-900">ì—ì–´íŒŸ í”„ë¡œ 3</span>
            </div>
            <div class="flex items-center space-x-3 text-sm">
                <span class="text-gray-600">í•„í„° ê¸°ê°„: 2025.01.15 ~ 2025.02.07</span>
                <button class="bg-main text-white px-4 py-2 rounded-lg font-medium hover:opacity-90 transition shadow-md flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                    </svg>
                    ğŸ” ì ìš©í•˜ê¸°
                </button>
                <button class="bg-gray-200 text-gray-800 px-3 py-2 rounded-lg font-medium hover:bg-gray-300 transition flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                    </svg>
                </button>
            </div>
        </div>
    </header>

    <!-- 1. KPI Summary Cards (4 Columns) -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        <!-- Card 1: ì´ ë¦¬ë·° ìˆ˜ -->
        <div class="card">
            <h3 class="text-sm font-medium text-gray-500">ğŸ’¬ ì´ ë¦¬ë·° ìˆ˜</h3>
            <div class="mt-1 flex items-end justify-between">
                <p class="text-3xl font-extrabold text-gray-900" id="kpi-total">1,235ê±´</p>
                <span class="kpi-change-up text-sm font-semibold">+12%</span>
            </div>
            <p class="mt-2 text-xs text-gray-400">ë¶„ì„ ëŒ€ìƒ ì „ì²´ ë¦¬ë·° ìˆ˜</p>
        </div>
        <!-- Card 2: ê¸ì • ë¹„ìœ¨ -->
        <div class="card">
            <h3 class="text-sm font-medium text-gray-500">ğŸ˜€ ê¸ì • ë¹„ìœ¨</h3>
            <div class="mt-1 flex items-end justify-between">
                <p class="text-3xl font-extrabold text-gray-900" id="kpi-pos">78%</p>
                <span class="kpi-change-up text-sm font-semibold flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-0.5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.47 10.74a.75.75 0 010-1.06l3.75-3.75a.75.75 0 011.06 0l3.75 3.75a.75.75 0 01-1.06 1.06L10 7.31l-3.22 3.22a.75.75 0 01-1.06 0z" clip-rule="evenodd" /></svg>+3%</span>
            </div>
            <p class="mt-2 text-xs text-gray-400">ê¸ì • í‰ê°€ ë¹„ì¤‘</p>
        </div>
        <!-- Card 3: ë¶€ì • ë¹„ìœ¨ -->
        <div class="card">
            <h3 class="text-sm font-medium text-gray-500">ğŸ˜Ÿ ë¶€ì • ë¹„ìœ¨</h3>
            <div class="mt-1 flex items-end justify-between">
                <p class="text-3xl font-extrabold text-gray-900" id="kpi-neg">12%</p>
                <span class="kpi-change-down text-sm font-semibold flex items-center"><svg xmlns="http://www.w3.org/2000/svg" class="h-3 w-3 mr-0.5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M14.53 9.26a.75.75 0 010 1.06l-3.75 3.75a.75.75 0 01-1.06 0l-3.75-3.75a.75.75 0 011.06-1.06L10 12.69l3.22-3.22a.75.75 0 011.06 0z" clip-rule="evenodd" /></svg>-2%</span>
            </div>
            <p class="mt-2 text-xs text-gray-400">ë¶€ì • í‰ê°€ ë¹„ì¤‘</p>
        </div>
        <!-- Card 4: ì¢…í•© ìŠ¤ì½”ì–´ -->
        <div class="card">
            <h3 class="text-sm font-medium text-gray-500">â­ ì¢…í•© ìŠ¤ì½”ì–´</h3>
            <div class="mt-1 flex items-end justify-between">
                <p class="text-3xl font-extrabold text-gray-900" id="kpi-score">4.5 / 5.0</p>
                <span class="kpi-change-up text-sm font-semibold">+0.2</span>
            </div>
            <p class="mt-2 text-xs text-gray-400">ì „ì²´ ê°ì • ì ìˆ˜ ê¸°ë°˜ ì‚°ì¶œ</p>
        </div>
    </div>

    <!-- Main Chart Section (2 Columns) -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- 2. ì¼ìë³„ ê¸Â·ë¶€ì • í¬í•¨ ë¦¬ë·° ë¹„ìœ¨ (Cumulative Bar + Line) -->
        <div class="card lg:col-span-2">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š ì¼ìë³„ ê¸Â·ë¶€ì • í¬í•¨ ë¦¬ë·° ë¹„ìœ¨</h2>
            <div class="relative h-96">
                <canvas id="dailyTrendChart"></canvas>
            </div>
            <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 text-sm">
                <h4 class="font-bold text-gray-700 mb-1">ğŸ“ˆ ê²°ê³¼ ìš”ì•½:</h4>
                <p>ê¸ì • ì–¸ê¸‰ 62% â†’ 78%ë¡œ ìƒìŠ¹, ë¶€ì • ì–¸ê¸‰ 38% â†’ 22%ë¡œ ê°ì†Œ. í•´ë‹¹ì¼ ë¦¬ë·° ìˆ˜: 120ê±´ â†’ 310ê±´. íŒì›¨ì–´ ì—…ë°ì´íŠ¸ ì´í›„ â€œë…¸ì´ì¦ˆ ìº”ìŠ¬ë§â€ ê´€ë ¨ ê¸ì • ë¦¬ë·° ê¸‰ì¦.</p>
            </div>
        </div>

        <!-- 3. ì†ì„±ë³„ ê°ì • ë°¸ëŸ°ìŠ¤ (Radar Chart) -->
        <div class="card lg:col-span-1">
            <h2 class="text-xl font-semibold mb-4">ğŸ•¸ï¸ ì†ì„±ë³„ ê°ì • ë°¸ëŸ°ìŠ¤</h2>
            <div class="relative h-96">
                <canvas id="radarChart"></canvas>
            </div>
            <div class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200 text-sm">
                <h4 class="font-bold text-gray-700 mb-1">ğŸ“ˆ í•´ì„:</h4>
                <p>â€œë””ìì¸â€, â€œë¸Œëœë“œ ì‹ ë¢°ë„â€ëŠ” ê¸ì • ë¹„ì¤‘ ë†’ìŒ. â€œë°°í„°ë¦¬â€, â€œì „ì› íš¨ìœ¨â€ì€ ë¶€ì • í”¼ë“œë°± ìƒëŒ€ì ìœ¼ë¡œ ë§ìŒ.</p>
            </div>
        </div>
    </div>

    <!-- Detailed Analysis Section (Grid) -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- 4. ì†ì„±ë³„ ê¸Â·ë¶€ì • ë¶„ê¸°í˜• ë§‰ëŒ€ ê·¸ë˜í”„ (Custom Chart.js) -->
        <div class="card lg:col-span-2">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š ì†ì„±ë³„ ê¸Â·ë¶€ì • ë¶„ê¸°í˜• ë§‰ëŒ€ ê·¸ë˜í”„</h2>
            <div class="relative h-96">
                <canvas id="splitBarChart"></canvas>
            </div>
        </div>

        <!-- 5. ì†ì„± ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ (Custom HTML Grid) -->
        <div class="card lg:col-span-1">
            <h2 class="text-xl font-semibold mb-4">ğŸ”¥ ì†ì„± ìƒê´€ê´€ê³„ íˆíŠ¸ë§µ</h2>
            <div class="grid grid-cols-6 text-center text-sm font-semibold border-b border-gray-200 pb-2">
                <div class="text-gray-500"></div>
                <div class="text-gray-600">ë””ìì¸</div>
                <div class="text-gray-600">ê°€ê²©</div>
                <div class="text-gray-600">í’ˆì§ˆ</div>
                <div class="text-gray-600">ë°°í„°ë¦¬</div>
                <div class="text-gray-600">ì°©ìš©ê°</div>
            </div>
            <div id="heatmap-grid" class="mt-2 text-xs">
                <!-- Data will be populated by JS -->
            </div>
            <p class="mt-4 text-xs text-gray-500">
                <span class="text-main font-bold">ğŸ”µ</span> ì§„í• ìˆ˜ë¡ í•¨ê»˜ ì–¸ê¸‰ë˜ëŠ” ë¹ˆë„ê°€ ë†’ìŒ.<br>
                ì˜ˆ: ë””ìì¸â€“ê°€ê²©(0.82) â†’ â€œë””ìì¸ ë§Œì¡±ë„â€ê°€ â€œê°€ê²© ì¸ì‹â€ì— ì˜í–¥
            </p>
        </div>
    </div>

    <!-- Word Cloud & Review Sample (2 Columns) -->
    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
        <!-- 6. ê°ì • ì›Œë“œí´ë¼ìš°ë“œ (Custom HTML) -->
        <div class="card">
            <h2 class="text-xl font-semibold mb-4">ğŸŒˆ ê°ì • ì›Œë“œí´ë¼ìš°ë“œ</h2>
            <div class="flex flex-wrap gap-3" id="wordcloud-pos">
                <!-- Positive Keywords -->
                <span style="font-size: 36px; color: var(--main-color);" class="font-bold">ë§Œì¡±</span>
                <span style="font-size: 30px; color: var(--main-color);">ë””ìì¸</span>
                <span style="font-size: 28px; color: var(--main-color);">ìŒì§ˆ</span>
                <span style="font-size: 24px; color: var(--main-color);">í¸ì•ˆ</span>
                <span style="font-size: 22px; color: var(--main-color);">ì°©ìš©ê°</span>
                <span style="font-size: 20px; color: var(--main-color);">ë…¸ìº”ì¢‹ìŒ</span>
            </div>
            <div class="border-t border-gray-100 my-4"></div>
            <div class="flex flex-wrap gap-3" id="wordcloud-neg">
                <!-- Negative Keywords -->
                <span style="font-size: 36px; color: var(--neutral-color);" class="font-bold">ë¹„ì‹¸ë‹¤</span>
                <span style="font-size: 30px; color: var(--neutral-color);">ë°°í„°ë¦¬</span>
                <span style="font-size: 26px; color: var(--neutral-color);">ë¬´ê²ë‹¤</span>
                <span style="font-size: 22px; color: var(--neutral-color);">ëŠê¹€</span>
                <span style="font-size: 20px; color: var(--neutral-color);">ë°œì—´</span>
            </div>
        </div>

        <!-- 7. ë¦¬ë·° ì›ë¬¸ ìƒ˜í”Œ (Table) -->
        <div class="card">
            <h2 class="text-xl font-semibold mb-4">ğŸ’¬ ë¦¬ë·° ì›ë¬¸ ìƒ˜í”Œ</h2>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead>
                        <tr class="text-xs font-medium text-gray-500 uppercase tracking-wider bg-gray-50">
                            <th class="px-3 py-3 text-left">ë‚ ì§œ</th>
                            <th class="px-3 py-3 text-left">ë¦¬ë·° ë‚´ìš©</th>
                            <th class="px-3 py-3 text-left">ê°ì • ìš”ì•½</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200 text-sm" id="review-table-body">
                        <!-- Data will be populated by JS -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- Insights and AI Report Section (3 Columns + 1) -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- 8. ì¸ì‚¬ì´íŠ¸ ì¹´ë“œ ì„¹ì…˜ -->
        <div class="card">
            <h2 class="text-lg font-semibold mb-3">A. í•µì‹¬ ì¸ì‚¬ì´íŠ¸</h2>
            <p class="whitespace-pre-wrap text-sm text-gray-700">ğŸ‘ ì „ì²´ ê¸ì •ë¥  78%ë¡œ ìƒìŠ¹ ì¤‘
â€˜ë””ìì¸Â·ì°©ìš©ê°Â·ìŒì§ˆâ€™ ì£¼ìš” ê°•ì </p>
        </div>
        <div class="card">
            <h2 class="text-lg font-semibold mb-3">B. ê°œì„  ì œì•ˆ</h2>
            <p class="whitespace-pre-wrap text-sm text-gray-700">âš™ï¸ ë°°í„°ë¦¬ ì§€ì†ì‹œê°„ ê´€ë ¨ ë¶€ì • ë¦¬ë·° 40%â†‘
ì „ì› íš¨ìœ¨ ê°œì„  í•„ìš”</p>
        </div>
        <div class="card">
            <h2 class="text-lg font-semibold mb-3">C. ë¦¬ë·° ìƒ˜í”Œ</h2>
            <p class="whitespace-pre-wrap text-sm text-gray-700">ğŸ’¬ â€œë””ìì¸ì€ ì˜ˆìœë° ê°€ê²©ì´ ë¹„ì‹¸ìš”.â€
ğŸ’¬ â€œì†ŒìŒì´ ê±°ì˜ ì—†ì–´ ë§Œì¡±í•©ë‹ˆë‹¤.â€
ğŸ’¬ â€œë°°í„°ë¦¬ ë¹¨ë¦¬ ë‹³ì•„ìš”.â€</p>
        </div>
    </div>

    <div class="grid grid-cols-1 gap-6">
        <!-- 9. AI ì¸ì‚¬ì´íŠ¸ ë¦¬í¬íŠ¸ (LLM ìë™ ìƒì„±) -->
        <div class="card">
            <h2 class="text-xl font-semibold mb-4">ğŸ¤– AI ì¸ì‚¬ì´íŠ¸ ë¦¬í¬íŠ¸</h2>
            <div class="p-4 bg-blue-50 border border-blue-200 rounded-lg text-sm whitespace-pre-wrap text-gray-800">
                ğŸ” AI ìë™ ë¶„ì„ ìš”ì•½
- ê¸ì • ìš”ì¸: ë””ìì¸, ì°©ìš©ê°, ìŒì§ˆ (ì „ì²´ ë¦¬ë·°ì˜ 70% ì´ìƒ)
- ë¶€ì • ìš”ì¸: ë°°í„°ë¦¬ ì§€ì†ì‹œê°„, ê°€ê²©
- ì¸ì‚¬ì´íŠ¸: ì‹ ê·œ ë¦¬ë·° ìœ ì…ê³¼ í•¨ê»˜ ê¸ì •ë¥  ìƒìŠ¹. íŒì›¨ì–´ ì—…ë°ì´íŠ¸ ì˜í–¥ ê°€ëŠ¥ì„± ë†’ìŒ.
            </div>
        </div>
    </div>

    <!-- 10. ë¦¬í¬íŠ¸ ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ -->
    <div class="pt-4 pb-12 flex justify-center">
        <button id="download-pdf-btn" class="bg-main text-white px-8 py-3 rounded-xl font-bold text-lg hover:opacity-90 transition shadow-lg flex items-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                <path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" />
            </svg>
            ğŸ“¥ [ ë¦¬í¬íŠ¸ PDF ë‹¤ìš´ë¡œë“œ ]
        </button>
    </div>

</div>

<script type="module">
    // --- Firebase Initialization (Required for Canvas Environment) ---
    // NOTE: This app does not use Firestore for persistent data storage, 
    // but the environment requires Firebase initialization/auth setup.
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    
    // Global variables (set by Canvas environment)
    const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
    const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
    const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

    let auth;

    window.onload = async () => {
        try {
            const app = initializeApp(firebaseConfig);
            auth = getAuth(app);
            
            if (initialAuthToken) {
                await signInWithCustomToken(auth, initialAuthToken);
            } else {
                await signInAnonymously(auth);
            }
        } catch (error) {
            console.error("Firebase Auth Error:", error);
        }

        // Initialize all components after window load
        initializeDashboard();
    };

    // --- Static Data (As requested in the prompt) ---
    const primaryColor = '#5B8EFF';
    const neutralColor = '#CBD5E1';
    const newReviewColor = '#111827';
    const positiveHighlight = '#10B981'; // Green for ğŸŸ©
    const negativeHighlight = '#EF4444'; // Red for ğŸŸ¥
    const fontColor = '#333333';

    const dailyTrendData = {
        dates: ['1/15', '1/18', '1/21', '1/24', '1/27', '1/30', '2/02', '2/07'],
        // Positive ratio (78%) and Negative ratio (12%) sum to 90%, leaving 10% Neutral/Unspecified.
        // I will use Pos and Neutral/Unspecified for the stacked bar and plot Negative ratio separately to match the prompt's visualization concept (Cumulative Bar for Pos/Neg, Line for New Reviews)
        // Since the prompt shows a simple two-bar stack (Positive/Negative), I will normalize them for the stack, assuming the prompt meant 78% Positive and 12% *of the remaining* or just use 78% and 12% and let Chart.js stack the smaller one on top of a base. A better approach for the *cumulative* bar is to track Positive, Negative, and Neutral so they sum to 100%. I'll derive Neutral.
        positive: [62, 65, 68, 70, 72, 75, 77, 78], // %
        negative: [38, 35, 32, 30, 28, 25, 23, 22], // % (Used the inverse of positive trend for simplification)
        newReviews: [120, 150, 200, 250, 280, 300, 305, 310] // counts
    };

    const radarData = {
        labels: ['ë””ìì¸', 'ì°©ìš©ê°', 'ìŒì§ˆ', 'ë°°í„°ë¦¬', 'ì „ì› íš¨ìœ¨', 'ë¸Œëœë“œ ì‹ ë¢°ë„'],
        positive: [90, 82, 75, 60, 55, 88], // %
        negative: [10, 18, 25, 40, 45, 12], // %
    };

    const splitBarRawData = [
        { label: 'ê°€ê²©', negRatio: 80, negCount: 100, posRatio: 20, posCount: 25 },
        { label: 'ë””ìì¸', negRatio: 10, negCount: 15, posRatio: 90, posCount: 150 },
        { label: 'ìŒì§ˆ', negRatio: 25, negCount: 30, posRatio: 75, posCount: 90 },
        { label: 'ë°°í„°ë¦¬', negRatio: 40, negCount: 50, posRatio: 60, posCount: 70 },
        { label: 'ì°©ìš©ê°', negRatio: 18, negCount: 20, posRatio: 82, posCount: 95 },
    ];
    
    const correlationLabels = ['ë””ìì¸', 'ê°€ê²©', 'í’ˆì§ˆ', 'ë°°í„°ë¦¬', 'ì°©ìš©ê°'];
    const correlationMatrix = {
        'ë””ìì¸': { 'ê°€ê²©': 0.82, 'í’ˆì§ˆ': 0.45, 'ë°°í„°ë¦¬': 0.22, 'ì°©ìš©ê°': 0.35 },
        'ê°€ê²©': { 'í’ˆì§ˆ': 0.78, 'ë°°í„°ë¦¬': 0.32, 'ì°©ìš©ê°': 0.18 },
        'í’ˆì§ˆ': { 'ë°°í„°ë¦¬': 0.41, 'ì°©ìš©ê°': 0.33 },
        'ë°°í„°ë¦¬': { 'ì°©ìš©ê°': 0.27 }
    };

    const reviewSamples = [
        { date: '2/02', content: 'ë””ìì¸ì€ ì˜ˆì˜ê³  ì°©ìš©ê°ë„ ì¢‹ì•„ìš”', summary: [{ text: 'ë””ìì¸', type: 'pos' }, { text: 'ì°©ìš©ê°', type: 'pos' }] },
        { date: '2/05', content: 'ë°°í„°ë¦¬ê°€ ë„ˆë¬´ ë¹¨ë¦¬ ë‹³ì•„ìš”', summary: [{ text: 'ë°°í„°ë¦¬', type: 'neg' }] },
        { date: '2/06', content: 'ë…¸ì´ì¦ˆ ìº”ìŠ¬ë§ì´ ëŒ€ë°•ì´ì—ìš”', summary: [{ text: 'ìŒì§ˆ', type: 'pos' }, { text: 'ê¸°ëŠ¥', type: 'pos' }] },
        { date: '2/07', content: 'ê°€ê²©ì´ ì¢€ ë¹„ì‹¸ì§€ë§Œ ë§Œì¡±í•´ìš”', summary: [{ text: 'ê°€ê²©', type: 'neg' }, { text: 'ë§Œì¡±', type: 'pos' }] },
    ];


    // --- Core Functions ---

    function initializeDashboard() {
        renderReviewTable();
        renderHeatmap();
        initializeDailyTrendChart();
        initializeRadarChart();
        initializeSplitBarChart();
        setupPDFDownload();
    }

    // 1. Daily Trend Chart (Bar + Line)
    function initializeDailyTrendChart() {
        const ctx = document.getElementById('dailyTrendChart').getContext('2d');
        const neutralData = dailyTrendData.positive.map((pos, i) => 100 - pos); // Simplified neutral/unspecified

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: dailyTrendData.dates,
                datasets: [{
                    label: 'ê¸ì • ë¹„ìœ¨ (%)',
                    data: dailyTrendData.positive,
                    backgroundColor: primaryColor,
                    yAxisID: 'y',
                    stack: 'Stack 0',
                }, {
                    label: 'ë¶€ì • ë¹„ìœ¨ ë° ê¸°íƒ€ (%)',
                    data: dailyTrendData.negative,
                    backgroundColor: neutralColor,
                    yAxisID: 'y',
                    stack: 'Stack 0',
                }, {
                    type: 'line',
                    label: 'í•´ë‹¹ì¼ ì‹ ê·œ ë¦¬ë·° ìˆ˜ (ê±´ìˆ˜)',
                    data: dailyTrendData.newReviews,
                    borderColor: newReviewColor,
                    borderWidth: 2,
                    pointBackgroundColor: newReviewColor,
                    yAxisID: 'y1',
                    fill: false,
                    tension: 0.3,
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: fontColor
                        }
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false,
                    }
                },
                scales: {
                    x: {
                        stacked: true,
                        grid: { display: false }
                    },
                    y: {
                        stacked: true,
                        position: 'left',
                        title: { display: true, text: 'ë¹„ìœ¨ (%)', color: primaryColor },
                        max: 100,
                        ticks: { color: primaryColor }
                    },
                    y1: {
                        position: 'right',
                        title: { display: true, text: 'ì‹ ê·œ ë¦¬ë·° ìˆ˜ (ê±´ìˆ˜)', color: newReviewColor },
                        grid: { drawOnChartArea: false },
                        ticks: { color: newReviewColor }
                    }
                }
            }
        });
    }

    // 2. Radar Chart
    function initializeRadarChart() {
        const ctx = document.getElementById('radarChart').getContext('2d');

        new Chart(ctx, {
            type: 'radar',
            data: {
                labels: radarData.labels,
                datasets: [{
                    label: 'ê¸ì • ë¹„ìœ¨',
                    data: radarData.positive,
                    backgroundColor: 'rgba(91, 142, 255, 0.4)', // Light Blue
                    borderColor: primaryColor,
                    pointBackgroundColor: primaryColor,
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: primaryColor
                }, {
                    label: 'ë¶€ì • ë¹„ìœ¨',
                    data: radarData.negative,
                    backgroundColor: 'rgba(203, 213, 225, 0.4)', // Light Gray
                    borderColor: neutralColor,
                    pointBackgroundColor: neutralColor,
                    pointBorderColor: '#fff',
                    pointHoverBackgroundColor: '#fff',
                    pointHoverBorderColor: neutralColor
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                        labels: { color: fontColor }
                    }
                },
                scales: {
                    r: {
                        angleLines: { color: '#E5E7EB' },
                        grid: { color: '#E5E7EB' },
                        pointLabels: { color: fontColor, font: { size: 14 } },
                        suggestedMin: 0,
                        suggestedMax: 100,
                        ticks: {
                            stepSize: 20,
                            backdropColor: 'rgba(255, 255, 255, 0.7)',
                            color: fontColor
                        }
                    }
                }
            }
        });
    }

    // 3. Split Bar Chart (Horizontal Bar with Labels)
    function initializeSplitBarChart() {
        // Chart.js UMD ë²„ì „ì—ì„œëŠ” ì½”ì–´ ì»´í¬ë„ŒíŠ¸ë“¤ì´ ê¸°ë³¸ ë“±ë¡ë˜ë¯€ë¡œ, ì¤‘ë³µ ë“±ë¡ì„ ì œê±°í•˜ì—¬ TypeErrorë¥¼ í•´ê²°í•©ë‹ˆë‹¤.
        // Chart.register(Chart.elements.Rectangle);
        // Chart.register(Chart.Tooltip, Chart.Legend, Chart.controllers.bar);
        // Chart.register(Chart.plugins.Plugin, Chart.plugins.Tooltip, Chart.plugins.Legend);
        // (datalabels í”ŒëŸ¬ê·¸ì¸ì€ ì˜µì…˜ì—ì„œ ì‚¬ìš©ë˜ì§€ ì•Šì•„ ë“±ë¡ ë¡œì§ì„ ìƒëµí•©ë‹ˆë‹¤.)

        const labels = splitBarRawData.map(d => d.label);
        const negData = splitBarRawData.map(d => -d.negRatio); // Negative values for left side
        const posData = splitBarRawData.map(d => d.posRatio);  // Positive values for right side

        const ctx = document.getElementById('splitBarChart').getContext('2d');

        new Chart(ctx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'ë¶€ì • ë¹„ìœ¨ (ì™¼ìª½)',
                    data: negData,
                    backgroundColor: neutralColor,
                    barPercentage: 0.7
                }, {
                    label: 'ê¸ì • ë¹„ìœ¨ (ì˜¤ë¥¸ìª½)',
                    data: posData,
                    backgroundColor: primaryColor,
                    barPercentage: 0.7
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                indexAxis: 'y',
                plugins: {
                    legend: {
                        position: 'top',
                        labels: {
                            color: fontColor
                        }
                    },
                    tooltip: {
                        callbacks: {
                            label: function(context) {
                                const rawValue = Math.abs(context.raw);
                                const count = context.datasetIndex === 0 ? splitBarRawData[context.dataIndex].negCount : splitBarRawData[context.dataIndex].posCount;
                                return `${context.dataset.label}: ${rawValue}% (${count}ê°œ)`;
                            }
                        }
                    },
                    datalabels: {
                         // Data labels are tricky in split bars. I'll rely on tooltips/hover for clean design.
                         // Custom rendering for ratio/count at bar ends is possible but complex for a single file demo.
                         display: false
                    }
                },
                scales: {
                    x: {
                        stacked: true,
                        min: -100,
                        max: 100,
                        ticks: {
                            callback: function(value) {
                                return Math.abs(value) + '%';
                            },
                            color: fontColor
                        },
                        title: {
                            display: true,
                            text: 'ê°ì • ë¹„ìœ¨'
                        },
                        grid: {
                            color: (context) => (context.tick.value === 0 ? '#000' : '#E5E7EB') // Center line darker
                        }
                    },
                    y: {
                        stacked: true,
                        grid: { display: false },
                        ticks: { color: fontColor }
                    }
                }
            }
        });
    }


    // 4. Heatmap Rendering (Custom HTML)
    function renderHeatmap() {
        const gridContainer = document.getElementById('heatmap-grid');
        let html = '';

        correlationLabels.forEach((rowLabel, rowIndex) => {
            html += `<div class="grid grid-cols-6 items-center border-b border-gray-100 py-2">`;
            
            // Row Label
            html += `<div class="text-xs font-semibold text-gray-600">${rowLabel}</div>`;

            correlationLabels.forEach((colLabel, colIndex) => {
                let cellContent = '';
                let bgColor = 'bg-white';
                let value = null;

                if (rowIndex === colIndex) {
                    // Diagonal (Self-correlation)
                    cellContent = '-';
                    bgColor = 'bg-gray-100';
                } else if (rowIndex > colIndex) {
                    // Mirrored side, fetch from upper-right triangle
                    value = correlationMatrix[colLabel] ? correlationMatrix[colLabel][rowLabel] : null;
                } else {
                    // Upper-right triangle
                    value = correlationMatrix[rowLabel] ? correlationMatrix[rowLabel][colLabel] : null;
                }

                if (value !== null) {
                    // Calculate color intensity (0.18 min, 0.82 max)
                    const normalized = (value - 0.18) / (0.82 - 0.18);
                    const intensity = Math.round(normalized * 5); // Scale from 0 to 5
                    
                    let icon = 'âšª';
                    if (value >= 0.7) icon = 'ğŸ”µ';
                    else if (value >= 0.4) icon = 'ğŸŸ¢';
                    else if (value >= 0.2) icon = 'âšª';

                    bgColor = `bg-blue-${100 + intensity * 100}`;
                    cellContent = `<span class="text-lg">${icon}</span> <span class="font-medium">${value.toFixed(2)}</span>`;
                }

                html += `<div class="p-1 h-full flex flex-col justify-center items-center ${bgColor} rounded-sm">${cellContent}</div>`;
            });

            html += `</div>`;
        });

        gridContainer.innerHTML = html;
    }


    // 5. Review Table Rendering
    function renderReviewTable() {
        const tbody = document.getElementById('review-table-body');
        let html = '';

        reviewSamples.forEach(review => {
            const summaryTags = review.summary.map(item => {
                const tagClass = item.type === 'pos' ? 'bg-pos-light text-pos' : 'bg-neg-light text-neg';
                const tagIcon = item.type === 'pos' ? 'ğŸŸ©' : 'ğŸŸ¥';
                return `<span class="inline-flex items-center px-2 py-0.5 rounded-full text-xs font-medium ${tagClass}">${tagIcon} ${item.text}</span>`;
            }).join(' ');

            html += `
                <tr class="hover:bg-gray-50">
                    <td class="px-3 py-2 whitespace-nowrap text-gray-500">${review.date}</td>
                    <td class="px-3 py-2 text-gray-900">${review.content}</td>
                    <td class="px-3 py-2 whitespace-nowrap">${summaryTags}</td>
                </tr>
            `;
        });

        tbody.innerHTML = html;
    }

    // 6. PDF Download Setup
    function setupPDFDownload() {
        document.getElementById('download-pdf-btn').addEventListener('click', () => {
            const element = document.getElementById('dashboard-content');
            
            // Temporary hide the download button to prevent it from showing in the PDF
            const downloadButton = document.getElementById('download-pdf-btn');
            downloadButton.style.display = 'none';

            // html2pdf options
            const opt = {
                margin: 1,
                filename: 'ì—ì–´íŒŸí”„ë¡œ3_ë¦¬ë·°_ë¶„ì„_ë¦¬í¬íŠ¸.pdf',
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, logging: true, dpi: 192, letterRendering: true },
                jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
            };

            html2pdf().set(opt).from(element).save().then(() => {
                // Restore the download button after saving
                downloadButton.style.display = 'flex';
            });
        });
    }

</script>
</body>
</html>
